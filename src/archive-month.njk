---
layout: layouts/base.njk
pagination:
  data: archiveManifest.shards
  size: 1
  alias: archiveEntry
permalink: false
eleventyComputed:
  permalink: "archive/{{ archiveEntry.parent }}/{{ archiveEntry.child }}/{{ archiveEntry.yearString }}/{{ archiveEntry.monthString }}/index.html"
  title: "{{ archiveEntry.child | formatArchiveLabel }} Archive — {{ archiveEntry.month | formatArchiveMonth(archiveEntry.year) }} | AventurOO"
  description: "Browse archived {{ archiveEntry.child | formatArchiveLabel }} stories from {{ archiveEntry.month | formatArchiveMonth(archiveEntry.year) }}."
  parentLabel: "{{ archiveEntry.parent | formatArchiveLabel }}"
  childLabel: "{{ archiveEntry.child | formatArchiveLabel }}"
  monthLabel: "{{ archiveEntry.month | formatArchiveMonth(archiveEntry.year) }}"
  og_title: "{{ archiveEntry.child | formatArchiveLabel }} Archive — {{ archiveEntry.month | formatArchiveMonth(archiveEntry.year) }}"
  og_url: "https://aventuroo.com/archive/{{ archiveEntry.parent }}/{{ archiveEntry.child }}/{{ archiveEntry.yearString }}/{{ archiveEntry.monthString }}/"
---
{% set entry = archiveEntry %}
{% set stories = entry.stories or [] %}
{% set storiesCount = stories | length %}
{% set paginationInfo = entry.pagination %}
{% set categorySlug = entry.child %}
{% if categorySlug == 'index' and entry.parent and entry.parent != 'index' %}
  {% set categorySlug = entry.parent %}
{% endif %}
<section class="archive archive-month">
  <div class="container">
    <header class="archive__header archive-month__header">
      <p class="archive-month__breadcrumbs" aria-label="Archive breadcrumb">
        <a href="{{ '/archive.html' | url }}">Archive</a>
        <span aria-hidden="true">/</span>
        <span>{{ entry.parent | formatArchiveLabel }}</span>
        <span aria-hidden="true">/</span>
        <span>{{ entry.child | formatArchiveLabel }}</span>
      </p>
      <h1 class="archive__title">{{ entry.month | formatArchiveMonth(entry.year) }}</h1>
      <p class="archive__description">
        Archived stories from {{ entry.child | formatArchiveLabel }} in {{ entry.month | formatArchiveMonth(entry.year) }}.
      </p>
    </header>

    <div class="archive-month__layout">
      <div class="archive-month__main">
        {% if storiesCount %}
          <ol class="archive-month__stories">
            {% for story in stories %}
              <li class="archive-month__story">
                <article class="archive-month__card">
                  {% if story.cover %}
                  <div class="archive-month__media">
                    <img src="{{ story.cover | escape }}" alt="{{ story.title or 'Story cover image' }}" loading="lazy">
                  </div>
                  {% endif %}
                  <div class="archive-month__content">
                    <h2 class="archive-month__story-title">
                      {% set storyUrl = story.canonical or story.archive_url or story.url %}
                      {% if storyUrl %}
                        <a href="{{ storyUrl | escape }}">{{ story.title or 'Untitled story' }}</a>
                      {% else %}
                        {{ story.title or 'Untitled story' }}
                      {% endif %}
                    </h2>
                    {% if story.excerpt %}
                      <p class="archive-month__excerpt">{{ story.excerpt }}</p>
                    {% endif %}
                    <dl class="archive-month__meta">
                      {% if story.date %}
                        <div>
                          <dt>Published</dt>
                          <dd>{{ story.date | formatArchiveDate }}</dd>
                        </div>
                      {% endif %}
                      {% set sourceUrl = story.source or storyUrl %}
                      {% if sourceUrl %}
                        <div>
                          <dt>Source</dt>
                          <dd><a href="{{ sourceUrl | escape }}">{{ sourceUrl | archiveHost }}</a></dd>
                        </div>
                      {% endif %}
                    </dl>
                  </div>
                </article>
              </li>
            {% endfor %}
          </ol>
        {% elseif entry.dataMissing %}
          <div class="archive-month__empty">
            <p>The archived data for this month is temporarily unavailable.</p>
            <p>Please review the <a href="{{ entry.dataHref }}">source JSON</a> for the latest updates.</p>
          </div>
        {% else %}
          <div class="archive-month__empty">
            <p>No archived stories were found for this month.</p>
            <p>Check back soon or explore other months from the archive index.</p>
          </div>
        {% endif %}

        {% if paginationInfo %}
          <footer class="archive-month__pagination">
            <p>
              Showing {{ storiesCount }} of {{ paginationInfo.total_items or entry.count }} archived stories.
              {% if paginationInfo.total_pages and paginationInfo.total_pages > 1 %}
                Page 1 of {{ paginationInfo.total_pages }}.
              {% endif %}
            </p>
            {% if paginationInfo.total_pages and paginationInfo.total_pages > 1 %}
              <p class="archive-month__note">Additional archive pages are available via the JSON feed linked below.</p>
            {% endif %}
          </footer>
        {% endif %}
      </div>

      <aside class="archive-month__sidebar" aria-label="Archive details">
        <div class="archive-month__panel">
          <h2 class="archive-month__panel-title">Archive Details</h2>
          <dl class="archive-month__stats">
            <div>
              <dt>Parent section</dt>
              <dd>{{ entry.parent | formatArchiveLabel }}</dd>
            </div>
            <div>
              <dt>Subsection</dt>
              <dd>{{ entry.child | formatArchiveLabel }}</dd>
            </div>
            {% if entry.count %}
            <div>
              <dt>Stories captured</dt>
              <dd>{{ entry.count }}</dd>
            </div>
            {% endif %}
            {% if entry.first_date or entry.last_date %}
            <div>
              <dt>Date range</dt>
              <dd>
                {% if entry.first_date %}
                  {{ entry.first_date | formatArchiveDate }}
                {% endif %}
                {% if entry.last_date and entry.last_date != entry.first_date %}
                  – {{ entry.last_date | formatArchiveDate }}
                {% endif %}
              </dd>
            </div>
            {% endif %}
            {% if entry.updatedAt %}
            <div>
              <dt>Last updated</dt>
              <dd>{{ entry.updatedAt | formatArchiveDate }}</dd>
            </div>
            {% endif %}
            {% if paginationInfo and paginationInfo.total_pages %}
            <div>
              <dt>Archive pages</dt>
              <dd>{{ paginationInfo.total_pages }}</dd>
            </div>
            {% endif %}
          </dl>
        </div>

        <div class="archive-month__panel">
          <h2 class="archive-month__panel-title">Data Sources</h2>
          <ul class="archive-month__links">
            <li><a href="{{ entry.dataHref }}">Download JSON</a></li>
            {% if entry.gzipHref %}
              <li><a href="{{ entry.gzipHref }}">Download JSON (gzip)</a></li>
            {% endif %}
            <li><a href="{{ '/data/archive/manifest.json' | url }}">View manifest</a></li>
          </ul>
          {% if paginationInfo and paginationInfo.total_pages and paginationInfo.total_pages > 1 %}
            <p class="archive-month__note">Use the JSON feed to access older pages beyond the first.</p>
          {% endif %}
        </div>

        <div class="archive-month__panel">
          <h2 class="archive-month__panel-title">Navigate</h2>
          <ul class="archive-month__links">
            <li><a href="{{ '/archive.html' | url }}">Archive index</a></li>
            {% if categorySlug %}
              <li><a href="{{ ('/category.html?cat=' ~ categorySlug) | url }}">View live category</a></li>
            {% endif %}
          </ul>
        </div>
      </aside>
    </div>
  </div>
</section>
