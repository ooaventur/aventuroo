<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>AventurOO — Stories</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS (nëse e ke tashmë globalisht, mund ta heqësh këtu) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Ikona/opsionale -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    .shadow-soft { box-shadow: 0 8px 24px rgba(0,0,0,.05); }
    .badge-cat { background:#f1f3f5; color:#333; border-radius: 999px; padding: .35rem .6rem; font-size:.75rem; }
    .line-clamp-3 {
      display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden;
    }
    .ad-banner { 
      background:#f8f9fa; border:1px dashed #ced4da; 
      border-radius:12px; padding:18px; text-align:center; 
      color:#6c757d; font-weight:600;
    }
    /* Siguro 4 kolona në desktop (≥992px) → 2 rreshta x 4 artikuj */
    @media (min-width: 992px){
      .story-card { width: 25%; }
    }
  </style>
</head>
<body>

  <div id="site-header"></div>

  <main class="container my-4">
    <header class="mb-4">
      <h1 class="h3 fw-bold mb-0">Stories</h1>
      <p class="text-muted mb-0">Explore all sub-categories and the latest stories.</p>
    </header>

    <!-- Këtu do të krijohen seksionet e nën-kategorive -->
    <div id="stories-sections" class="vstack gap-5"></div>
  </main>

  <div id="site-footer"></div>

  <!-- Bootstrap Bundle (dropdown i navbar-it) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
  <!-- Site header/footer -->
  <script src="site.js"></script>

  <script>
    // Inicializo header/footer
    renderHeader('Stories');
    renderFooter();

    // Konfigurim i nën-kategorive (label në UI, key = vlera që vjen nga posts.json)
    const SUBCATS = [
      { label: 'Flash Fiction',   key: 'Stories-Flash'     },
      { label: 'Literary',        key: 'Stories-Literary'  },
      { label: 'Nonfiction',      key: 'Stories-Nonfiction'},
      { label: 'Personal',        key: 'Stories-Personal'  },
      { label: 'Fantasy/Horror',  key: 'Stories-Fantasy'   },
    ];

    // Renditje (më të rejat të parat) — funksion robust për data "YYYY-MM-DD"
    function sortByDateDesc(arr){
      return arr.slice().sort((a,b)=> (b.date||'').localeCompare(a.date||''));
    }

    // Krijo HTML për një kartë
    function cardHTML(p){
      const title = p.title || 'Untitled';
      const img   = p.cover || 'assets/img/cover-fallback.jpg';
      const slug  = encodeURIComponent(p.slug || '');
      const excerpt = (p.excerpt || '').toString();

      return `
        <div class="story-card col-12 col-md-6 col-lg-3 d-flex">
          <article class="card border-0 shadow-soft w-100 h-100">
            <a href="article.html?slug=${slug}" class="ratio ratio-16x9">
              <img src="${img}" class="card-img-top object-fit-cover" alt="${title}">
            </a>
            <div class="card-body d-flex flex-column">
              <span class="badge-cat">${p.category || ''}</span>
              <h5 class="card-title fw-bold mt-2">
                <a class="stretched-link text-decoration-none link-dark" href="article.html?slug=${slug}">
                  ${title}
                </a>
              </h5>
              <p class="card-text text-muted line-clamp-3">${excerpt}</p>
              <div class="mt-auto small text-muted d-flex justify-content-between">
                <span>${p.date || ''}</span>
                <span>Read →</span>
              </div>
            </div>
          </article>
        </div>
      `;
    }

    // Seksioni për çdo nën-kategori: titull bold, 8 artikuj (2 rreshta × 4), dhe një banner ad në fund
    function sectionHTML(label, posts){
      const cards = posts.map(cardHTML).join('');
      return `
        <section class="story-sub mb-2">
          <div class="d-flex align-items-baseline justify-content-between mb-3">
            <h2 class="h4 fw-bold mb-0">${label}</h2>
            <!-- opsionale: link "see all" te stories.html?sub=<key> -->
          </div>
          <div class="row g-4">${cards}</div>
          <div class="mt-4">
            <!-- Banner AD: zëvendësoje me kodin e reklamës tënde -->
            <div class="ad-banner">
              970×250 — Banner Ad (replace with your ad code)
            </div>
          </div>
        </section>
      `;
    }

    async function loadAndRender(){
      try{
        const res = await fetch('data/posts.json', { cache: 'no-store' });
        const all = res.ok ? await res.json() : [];

        // Për çdo nën-kategori, merr postet, filtro, rendit, merr 8 më të fundit
        const container = document.getElementById('stories-sections');
        container.innerHTML = SUBCATS.map(sc => {
          const items = sortByDateDesc(
            all.filter(p => (p.category||'') === sc.key)
          ).slice(0, 8);

          // Nëse nuk ka artikuj, e shfaqim seksionin me një njoftim të vogël
          if (!items.length){
            return `
              <section class="story-sub mb-2">
                <div class="d-flex align-items-baseline justify-content-between mb-3">
                  <h2 class="h4 fw-bold mb-0">${sc.label}</h2>
                </div>
                <div class="alert alert-light border d-flex align-items-center" role="alert">
                  <i class="fa-regular fa-file-lines me-2"></i>
                  Nuk ka ende artikuj në këtë nën-kategori.
                </div>
                <div class="mt-4">
                  <div class="ad-banner">970×250 — Banner Ad</div>
                </div>
              </section>
            `;
          }

          return sectionHTML(sc.label, items);
        }).join('');

      } catch(err){
        console.error('Load posts error:', err);
        document.getElementById('stories-sections').innerHTML =
          `<div class="alert alert-danger">Nuk arrita të lexoj postimet.</div>`;
      }
    }

    loadAndRender();
  </script>
</body>
</html>
